# Travis CI configuration file
#
# ICRAR - International Centre for Radio Astronomy Research
# (c) UWA - The University of Western Australia, 2018
# Copyright by UWA (in the framework of the ICRAR)
# All rights reserved
#
# Contributed by Pascal Elahi
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307  USA
#

language: cpp
sudo: false

# We try with both GNU and LLVM
# When running with gcc-6 we also collect coverage information
# and upload it to coveralls
# matrix:
#  include:
#   - compiler: gcc
#     addons:
#      apt:
#       sources: ubuntu-toolchain-r-test
#       packages: [clang-format-3.8, g++-5, libhdf5-dev, hdf5-tools, libgsl0-dev]
#     env: COMPILER=g++-5
#   - compiler: gcc
#     addons:
#      apt:
#       sources: ubuntu-toolchain-r-test
#       packages: [clang-format-3.8, g++-5, libhdf5-dev, hdf5-tools, libgsl0-dev, libopenmpi-dev]
#     env: COMPILER=g++-5
#   - compiler: gcc
#     addons:
#      apt:
#       sources: ubuntu-toolchain-r-test
#       packages: [clang-format-3.8, g++-5, libhdf5-dev, hdf5-tools, libgsl0-dev, libopenmpi-dev]
#     env: COMPILER=g++-5 USEGAS=1 USESTARS=1
#   - compiler: gcc
#     addons:
#      apt:
#       sources: ubuntu-toolchain-r-test
#       packages: [clang-format-3.8, g++-5, libhdf5-dev, hdf5-tools, libgsl0-dev, libopenmpi-dev]
#     env: COMPILER=g++-5 USESWIFT=1
#   - compiler: gcc
#     addons:
#      apt:
#       sources: ubuntu-toolchain-r-test
#       packages: [clang-format-3.8, g++-6, libhdf5-dev, hdf5-tools, libgsl0-dev, libopenmpi-dev]
#     env: COMPILER=g++-6
#   - compiler: gcc
#     addons:
#      apt:
#       sources: ubuntu-toolchain-r-test
#       packages: [clang-format-3.8, g++-7, libhdf5-dev, hdf5-tools, libgsl0-dev, libopenmpi-dev]
#     env: COMPILER=g++-7
# 
# Default steps to travisCI:
#   before_install, install, script

package_list:
  - &package1
    - clang-format-3.8
    - g++-5
    - libhdf5-dev
    - hdf5-tools 
    - libgsl0-dev
  - &package2
    - clang-format-3.8
    - g++-5
    - libhdf5-dev
    - hdf5-tools
    - libgsl0-dev
    - libopenmpi-dev
  - &package3
    - clang-format-3.8
    - g++-5
    - libhdf5-dev
    - hdf5-tools
    - libgsl0-dev
    - libopenmpi-dev
  - &package4
    - clang-format-3.8
    - g++-5
    - libhdf5-dev
    - hdf5-tools
    - libgsl0-dev
    - libopenmpi-dev
  - &package5
    - clang-format-3.8
    - g++-6
    - libhdf5-dev
    - hdf5-tools
    - libgsl0-dev
    - libopenmpi-dev
  - &package6
    - clang-format-3.8
    - g++-7
    - libhdf5-dev
    - hdf5-tools
    - libgsl0-dev
    - libopenmpi-dev

build_list:
  - &build1
    compiler: gcc
    addons:
     apt:
      sources: ubuntu-toolchain-r-test
      packages: *package1
    env: COMPILER=g++-5
  - &build2
    compiler: gcc
    addons:
     apt:
      sources: ubuntu-toolchain-r-test
      packages: *package2
    env: COMPILER=g++-5
  - &build3
    compiler: gcc
    addons:
     apt:
      sources: ubuntu-toolchain-r-test
      packages: *package3
    env: COMPILER=g++-5 USEGAS=1 USESTARS=1
  - &build4
    compiler: gcc
    addons:
     apt:
      sources: ubuntu-toolchain-r-test
      packages: *package4
    env: COMPILER=g++-5 USESWIFT=1
  - &build5
    compiler: gcc
    addons:
     apt:
      sources: ubuntu-toolchain-r-test
      packages: *package5
    env: COMPILER=g++-6
  - &build6
    compiler: gcc
    addons:
     apt:
      sources: ubuntu-toolchain-r-test
      packages: *package6
    env: COMPILER=g++-7

    # source is added to inherit exported variables
# TODO: include a logical step to execute code linter
jobs:
  include:
    - stage: Code Lint
      script: ./.travis/test_codelint.sh
    - stage: Install
      <<: *build1
      script:
      - ./.travis/install.sh
      - ./.travis/test.sh
    - stage: Install
      <<: *build2
      script:
      - ./.travis/install.sh
      - ./.travis/test.sh
    - stage: Install
      <<: *build3
      script:
      - ./.travis/install.sh
      - ./.travis/test.sh
    - stage: Install
      <<: *build4
      script:
      - ./.travis/install.sh
      - ./.travis/test.sh
    - stage: Install
      <<: *build5
      script:
      - ./.travis/install.sh
      - ./.travis/test.sh
    - stage: Install
      <<: *build6
      script:
      - ./.travis/install.sh
      - ./.travis/test.sh

# TODO:
#   Transfer each execution to a job step
#   This allows conditional execution of for test
#   Automation

# before_install:
# - source .travis/before_install.sh

# install:
# - source .travis/install.sh

# script:
# - source .travis/test.sh
